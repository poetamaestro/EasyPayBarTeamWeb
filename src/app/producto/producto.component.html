<app-nav></app-nav>

<div class="component-container">
  <div class="page-head">
    <div class="row">
      <div class="col-sm-2">
        <i class="fa fa-chevron-left fa-3x" id="return" aria-hidden="true" [routerLink]="['/proveedor', idPro, 'categoria']"></i>
        <h1 class="page-title">{{ titulo }}</h1>
      </div>
      <div class="col-sm-10"><br>
        <div class="input-group search-bar" style="width: 40%; margin-left: 20px;">
          <input type="text" class="form-control text-primary" [(ngModel)]="pista" placeholder="Ingrese el producto a buscar">
          <span class="input-group-btn">
          <button class="btn btn-success" (click)="buscarProducto()" type="button">Buscar <i class="fa fa-search-plus" aria-hidden="true"></i></button>
          </span>
          <div class="alert-danger"><strong>{{ resultado }}</strong></div>
        </div>
      </div>
    </div>

  </div>
  <div class="page-main">
    <div class="page-section">
      <div class="row">
        <div class="col col-md-3" *ngFor="let produc of productos | async | paginate: { itemsPerPage: 8, currentPage: p }">
          <div class="product-panel main-color-black">
            <div class="product-img">
              <img src="{{produc.imagenURL}}" alt="Cinque Terre">
            </div>
            <div class="product-inf">
              <h4><strong>{{produc.nombre}}</strong></h4>
              <h6>${{produc.precio}}</h6>
            </div>
            <div class="product-bottom top-line-black">
              <button class="btn btn-xs btn-primary" (click)="openModalProductoVerDetalle(produc.$key, produc.nombre, produc.precio, produc.veces, produc.imagenURL)"><i class="fa fa-eye" aria-hidden="true"></i>
              </button>
              <button class="btn btn-xs btn-success" (click)="openModalProductoEditar(produc.$key, produc.nombre, produc.precio, produc.veces, produc.imagen, produc.imagenURL)"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>
              </button>
              <button class="btn btn-xs btn-danger" (click)="openModalProductoEliminar(produc.$key, produc.nombre, produc.precio, produc.veces, produc.imagen)"><i class="fa fa-trash-o" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <!-- Pagination -->
        <pagination-controls (pageChange)="p = $event"></pagination-controls>
      </div>
    </div>
  </div>
  <span class="app-action-md-fab"><button md-fab class="btn btn-success btn-md" (click)="openModalProductoCrear()"><i class="fa fa-plus" aria-hidden="true"></i></button></span>
</div>


<!-- Modal Ver Detalle -->
<modal #modalProductoVerDetalle>
  <modal-header>
    <h4 class="modal-title">Detalle del producto</h4>
  </modal-header>

  <modal-body>
    <div class="row">
      <div class="col col-sm-6">
        <div class="form-group">
          <label><h5><b>Nombre:</b></h5></label>
          <h5>{{ producto.nombre }}</h5>
        </div>

        <div class="form-group">
          <label><h5><b>Precio:</b></h5></label>
          <h5>${{ producto.precio }}</h5>
        </div>

        <div class="form-group">
          <label><h5><b>Veces Compradas:</b></h5></label>
          <h5>{{ producto.veces }}</h5>
        </div>
      </div>
      <div class="col col-sm-6">
        <img src="{{producto.imagenURL}}" alt="Producto">
      </div>
    </div>
  </modal-body>

  <modal-footer>
    <button type="button" class="btn btn-danger" style="margin-left: 0px" (click)="modalProductoVerDetalle.close()">
      <i class="fa fa-times" aria-hidden="true"></i> Salir
  </button>
  </modal-footer>
</modal>


<!-- Modal Eliminar -->
<modal #modalProductoEliminar>
  <modal-header [show-close]="false">
    <h4 class="modal-title">¿Desea Eliminar este Producto?</h4>
  </modal-header>

  <modal-body>
    <div class="form-group">
      <h5><b>Nombre:</b> {{ producto.nombre }}</h5>
    </div>

    <div class="form-group">
      <h5><b>Precio:</b> ${{ producto.precio }}</h5>
    </div>
  </modal-body>

  <modal-footer>
    <button type="button" class="btn btn-primary col-lg-5" data-dismiss="modal" (click)="eliminarProducto()"><i class="fa fa-check" aria-hidden="true"></i> Confirmar</button>
    <button type="button" class="btn btn-danger col-lg-5" style="margin-left: 0px" (click)="modalEliminar.close()"><i class="fa fa-times" aria-hidden="true"></i> Cancelar</button>
  </modal-footer>
</modal>

<!-- Modal Crear -->
<modal #modalProductoCrear>
  <modal-header [show-close]="false">
    <h4 class="modal-title">Registro de un nuevo producto</h4>
  </modal-header>

  <modal-body class="form-horizontal">
    <div class="form-group">
      <label class="col-lg-2 control-label"><h5><b>Nombre:</b></h5></label>
      <div class="col-lg-9">
        <input type="text" class="form-control" name="txtnombre" placeholder="Ingrese el nombre" [(ngModel)]="producto.nombre" #nombre="ngModel"
          required pattern="[A-Za-z ]+" />
        <span style="color:#e74c3c;" *ngIf="nombre.errors?.required"><p>El nombre es requerido.</p></span>
        <span style="color:#e74c3c;" *ngIf="nombre.errors?.pattern"><p>El nombre solo puede tener caracteres de A hasta la Z.</p></span>
      </div>
    </div>

    <div class="form-group">
      <label class="col-lg-2 control-label"><h5><b>Precio:</b></h5></label>
      <div class="col-lg-9">
        <input type="text" class="form-control" name="txtprecio" placeholder="Ingrese el nombre" [(ngModel)]="producto.precio" #precio="ngModel"
          required pattern="^\d+\.\d{2}$" />
        <span style="color:#e74c3c;" *ngIf="precio.errors?.required"><p>El precio es requerido.</p></span>
        <span style="color:#e74c3c;" *ngIf="precio.errors?.pattern"><p>El precio solo puede ser un número con 2 decimales.</p></span>
      </div>
    </div>

    <div class="form-group">
      <label class="col-lg-2 control-label"><h5><b>Imagen:</b></h5></label>
      <div class="col-lg-9">
        <input type="file" name="file" id="file" (change)="seleccionarImagen($event)" />
      </div>
    </div>
  </modal-body>
  <modal-footer>
    <div *ngIf="nombre.errors || precio.errors">
      <button type="button" class="btn btn-primary col-lg-5" disabled><i class="fa fa-check" aria-hidden="true"></i> Confirmar</button>
    </div>
    <div *ngIf="!nombre.errors && !precio.errors">
      <button type="button" class="btn btn-primary col-lg-5" data-dismiss="modal" (click)="agregarProducto()"><i class="fa fa-check" aria-hidden="true"></i> Confirmar</button>
    </div>
    <button type="button" class="btn btn-danger col-lg-5" (click)="modalCrear.close()"><i class="fa fa-times" aria-hidden="true"></i> Cancelar</button>
  </modal-footer>
</modal>

<!-- Modal Editar -->
<modal #modalProductoModificar>
  <modal-header [show-close]="false">
    <h4 class="modal-title">¿Desea Editar este Producto?</h4>
  </modal-header>
  <modal-body class="form-horizontal">
    <div class="form-group">
      <label class="col-lg-2 control-label"><h5><b>Nombre:</b></h5></label>
      <div class="col-lg-9">
        <input type="text" class="form-control" name="txtnombre" [value]="producto.nombre" placeholder="Ingrese el nombre" [(ngModel)]="producto.nombre"
          #nombre="ngModel" required pattern="[A-Za-z ]+" />
        <span style="color:#e74c3c;" *ngIf="nombre.errors?.required"><p>El nombre es requerido.</p></span>
        <span style="color:#e74c3c;" *ngIf="nombre.errors?.pattern"><p>El nombre solo puede tener caracteres de A hasta la Z.</p></span>
      </div>
    </div>
    <div class="form-group">
      <label class="col-lg-2 control-label"><h5><b>Precio:</b></h5></label>
      <div class="col-lg-9">
        <input type="text" class="form-control" name="txtprecio" [value]="producto.precio" placeholder="Ingrese el nombre" [(ngModel)]="producto.precio"
          #precio="ngModel" required pattern="^\d+\.\d{2}$" />
        <span style="color:#e74c3c;" *ngIf="precio.errors?.required"><p>El precio es requerido.</p></span>
        <span style="color:#e74c3c;" *ngIf="precio.errors?.pattern"><p>El precio solo puede ser un número con 2 decimales.</p></span>
      </div>
    </div>
    <div class="form-group">
      <label class="col-lg-2 control-label"><h5><b>Imagen:</b></h5></label>
      <div class="col-lg-9">
        <img src="{{producto.imagenURL}}" alt="Producto">
        <input type="file" name="file" id="file" (change)="seleccionarImagen($event)">
      </div>
    </div>
  </modal-body>
  <modal-footer>
    <div *ngIf="nombre.errors || precio.errors">
      <button type="button" class="btn btn-primary col-lg-5" disabled><i class="fa fa-check" aria-hidden="true"></i> Confirmar</button>
    </div>
    <div *ngIf="!nombre.errors && !precio.errors">
      <button type="button" class="btn btn-primary col-lg-5" data-dismiss="modal" (click)="actualizarProducto()"><i class="fa fa-check" aria-hidden="true"></i> Confirmar</button>
    </div>
    <button type="button" class="btn btn-danger col-lg-5" (click)="modalModificar.close()"><i class="fa fa-times" aria-hidden="true"></i> Cancelar</button>
  </modal-footer>
</modal>